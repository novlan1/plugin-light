import { traverseDeps } from '../../../src/webpack-plugin/dispatch-script/traverse-deps';
import path from 'path';
import { readFileSync, writeFileSync } from '@tencent/t-comm';


describe('traverseDeps', () => {
  it('project data', () => {
    const data = readFileSync(path.resolve(__dirname, './data/dispatch-script.inner-deps-raw.json'), true);

    const result = traverseDeps({
      deps: data.data,
      pages: [
        'src/project/user/views/fake-home/index',
        'src/project/user/views/index/index-home',
        'src/project/user/views/test/test',
        'src/project/user/views/webview/webview',
        'src/project/user/views/web-container/index',
        'src/project/user/views/match/match-detail-index',
        'src/project/user/views/match/match-detail/match-detail',
        'src/project/user/views/match-create/create/index',
        'src/project/user/views/match-update/create/create-rule',
        'src/project/user/views/match-update/create/create-custom-group-type',
        'src/project/user/views/match-update/create/create-recommend-set',
        'src/project/user/views/match-update/create/create-brand-set',
        'src/project/user/views/match-update/create/create-match-apply',
        'src/project/user/views/match-update/create/create-match-official',
        'src/project/user/views/match-update/create/create-match-questionnaire-set',
        'src/project/user/views/match-update/create/create-match-camp-set',
        'src/project/user/views/match-update/create/create-match-identity-verify',
        'src/project/user/views/match-update/create/create-match-questionnaire-guide',
        'src/project/user/views/match-update/create/create-match-info/index',
        'src/project/user/views/match-update/create/create-match-process',
        'src/project/user/views/match-update/create/create-custom-game-param',
        'src/project/user/views/match-update/edit/edit-rule',
        'src/project/user/views/match-update/edit/match-edit-basic',
        'src/project/user/views/match-update/edit/match-edit-apply',
        'src/project/user/views/match-update/edit/edit-custom-group-type',
        'src/project/user/views/match-update/match-config/match-reward/index',
        'src/project/user/views/match-update/quick-set/sche-set',
        'src/project/user/views/match-update/quick-set/watch-battle-set',
        'src/project/user/views/match-update/match-config/match-owner-recommend',
        'src/project/user/views/match-update/authorize/first-need-guide',
        'src/project/user/views/match-update/authorize/need-file-material',
        'src/project/user/views/match-update/authorize/authorize-confirm',
        'src/project/user/views/match-update/authorize/authorize-apply-file',
        'src/project/user/views/match-update/authorize/authorize-material',
        'src/project/user/views/match-update/authorize/webview',
        'src/project/user/views/match-update/create/create-match-random-param',
        'src/project/user/views/match-update/create/create-match-game-introduce',
        'src/project/user/views/other/album/album-share',
        'src/project/user/views/other/album/my-album',
        'src/project/user/views/other/album/album-detail',
        'src/project/user/views/other/album/album-edit',
        'src/project/user/views/other/album/album-rule',
        'src/project/user/views/other/album/event-theme',
        'src/project/user/views/other/douyu-channel-match/index',
        'src/project/user/views/other/qq-channel-match/index',
        'src/project/user/views/other/environment-tips/index',
        'src/project/user/views/other/debug/index',
        'src/project/user/views/other/launch-game/launch-game-mp-qq',
        'src/project/user/views/other/launch-game/bridge-launch-game',
        'src/project/user/views/other/test-join-room/test-join-room',
        'src/project/user/views/other/test-ingame-browser/test-ingame-browser',
        'src/project/user/views/other/phone/bind-phone',
        'src/project/user/views/other/third-plat-login/index',
        'src/project/user/views/other/third-plat-login/phone-login',
        'src/project/user/views/other/ingame-guard/index',
        'src/project/user/views/other/ingame-jump-page/ingame-jump-page',
        'src/project/user/views/other/openlink-jump-page/openlink-jump-page',
        'src/project/user/views/other/poster/poster',
        'src/project/user/views/other/live-code/index',
        'src/project/user/views/other/match-rule-detail/match-rule-detail',
        'src/project/user/views/other/match-data/match-data',
        'src/project/user/views/other/wework-group/wework-group',
        'src/project/user/views/other/apply-match-guide/index',
        'src/project/user/views/other/match-group/match-group',
        'src/project/user/views/sche/cycle-set/cycle-set',
        'src/project/user/views/sche/cup-set/cup-set',
        'src/project/user/views/sche/select-promotion-team/select-promotion-team',
        'src/project/user/views/sche/sche-set/sche-set',
        'src/project/user/views/sche/sche/sche',
        'src/project/user/views/owner/hor',
        'src/project/user/views/owner/owner-principal-code/owner-principal-code',
        'src/project/user/views/owner/owner-ranking',
        'src/project/user/views/owner/owner-ranking-previous',
        'src/project/user/views/owner/owner-introduce',
        'src/project/user/views/owner/owner-introduce-detail',
        'src/project/user/views/owner/owner-share',
        'src/project/user/views/owner/owner-club/owner-club',
        'src/project/user/views/owner/owner-club/owner-club-share',
        'src/project/user/views/owner/owner-club/owner-club-approve',
        'src/project/user/views/owner/owner-club/owner-club-visit',
        'src/project/user/views/owner/owner-club/owner-club-member',
        'src/project/user/views/owner/owner-club/owner-club-intro',
        'src/project/user/views/owner/coming-owner-tasks',
        'src/project/user/views/owner/personal-card',
        'src/project/user/views/owner/personal-card-share',
        'src/project/user/views/owner/owner-save',
        'src/project/user/views/battle-room/room',
        'src/project/user/views/battle-room/room-quick',
        'src/project/user/views/battle-room/room-searching',
        'src/project/user/views/battle-room/captcha-verify',
        'src/project/user/views/room/video-room/video-room',
        'src/project/user/views/room/create-live/create-live',
        'src/project/user/views/room/ai-room/ai-room',
        'src/project/user/views/room/league-room/league-room',
        'src/project/user/views/room/ai-room/battle-ai-room',
        'src/project/user/views/room/ai-room/ai-room-pc',
        'src/project/user/views/room/ai-room/ai-room-simulate-watch',
        'src/project/user/views/room/ai-room/ai-room-rank-live',
        'src/project/user/views/battle/battle-detail',
        'src/project/user/views/battle/battle-detail-undetermined',
        'src/project/user/views/home/history/index-history',
        'src/project/user/views/home/search/search',
        'src/project/user/views/home/home-live/home-live',
        'src/project/user/views/home/homepage/account-manage',
        'src/project/user/views/home/homepage/account-security',
        'src/project/user/views/home/homepage/account-log-off',
        'src/project/user/views/home/homepage/my-address',
        'src/project/user/views/home/homepage/my-address-edit',
        'src/project/user/views/home/homepage/customize-commentary',
        'src/project/user/views/home/homepage/account-unbind',
        'src/project/user/views/home/homepage/protocol',
        'src/project/user/views/home/homepage/privacy',
        'src/project/user/views/home/homepage/log-off-protocol',
        'src/project/user/views/home/homepage/homepage',
        'src/project/user/views/home/homepage/more-honor',
        'src/project/user/views/home/homepage/login',
        'src/project/user/views/home/homepage/focus-list',
        'src/project/user/views/home/homepage/test-whitelist',
        'src/project/user/views/home/highlight/highlight',
        'src/project/user/views/schedule-search/sche-search',
        'src/project/user/views/schedule-search/fuzzy-search',
        'src/project/user/views/team/team-list/index',
        'src/project/user/views/team/team-member/index',
        'src/project/user/views/team/team-member/team-index',
        'src/project/user/views/team/team-zone/team-zone',
        'src/project/user/views/team/team-search/team-search',
        'src/project/user/views/team/team-share/team-share',
        'src/project/user/views/team/team-home/team-home',
        'src/project/user/views/team/team-create/team-create',
        'src/project/user/views/team/team-logs/team-logs',
        'src/project/user/views/team/team-admin/team-admin',
        'src/project/user/views/team/team-player-search/team-player-search',
        'src/project/user/views/team/team-honor/index',
        'src/project/user/views/team/team-record/index',
        'src/project/user/views/team/team-group-member/index',
        'src/project/user/views/team/team-match-center/index',
        'src/project/user/views/team/team-join/index',
        'src/project/user/views/team/search-team/search-team',
        'src/project/user/views/message-center/message-center-index',
        'src/project/user/views/message-center/message-center-detail',
        'src/project/user/views/props-mall/props-mall',
        'src/project/user/views/props-mall/props-detail',
        'src/project/user/views/props-mall/order-record',
        'src/project/user/views/props-mall/funds-record',
        'src/project/user/views/props-mall/award-detail',
        'src/project/user/views/props-mall/props-buy',
        'src/project/user/views/award/my-award',
        'src/project/user/views/award/my-award-detail',
        'src/project/user/views/award/my-award-weixin',
        'src/project/user/views/award/send-award/award-sent-detail',
        'src/project/user/views/award/my-address/list-address',
        'src/project/user/views/award/my-address/editor-address',
        'src/project/user/views/award/send-award/member-award-detail',
        'src/project/user/views/award/send-award/member-award-detail-all',
        'src/project/user/views/bind-code/bind-code',
        'src/project/user/views/bind-code/bind-success',
        'src/project/user/views/bind-code/check-bind',
        'src/project/user/views/match-manage/match-ob-room',
        'src/project/user/views/match-manage/match-manager',
        'src/project/user/views/match-manage/match-manager-apply',
        'src/project/user/views/match-manage/match-manager-apply-list',
        'src/project/user/views/match-config/create-preview',
        'src/project/user/views/match-config/create-repeated-match-setting',
        'src/project/user/views/match-config/create-recommend-set-intro',
        'src/project/user/views/match-config/create-recommend-set-label',
        'src/project/user/views/match-config/create-match-place',
        'src/project/user/views/match-config/tencent-map',
        'src/project/user/views/match-config/tip-match-game-record',
        'src/project/user/views/match-config/schedule-list',
        'src/project/user/views/match-config/create-match-choosable',
        'src/project/user/views/match-config/bind-tip',
        'src/project/user/views/match-config/match-rate',
        'src/project/user/views/match-config/publish-news/index',
        'src/project/user/views/match-config/match-setting/index',
        'src/project/user/views/match-config/match-limit',
        'src/project/user/views/match-config/match-guide',
        'src/project/user/views/match-config/match-recommend-manage',
      ],
      mainPath: 'src/project/user/main.js',
    });

    writeFileSync(path.resolve(__dirname, './data/dispatch-script.result-deps.json'), result, true);

    expect(result).toMatchSnapshot();
  });
});
